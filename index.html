<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üéØ Detective Number Mystery</title>
    <style>
        body {
            font-family: 'Segoe UI', Verdana, sans-serif;
            background: #f1f7f8;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 480px;
            margin: 30px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 6px 24px #bbb;
            padding: 30px 18px 18px 18px;
            text-align: center;
        }
        h1 {
            margin: 0 0 10px 0;
            font-size: 2.1em;
            color: #006c70;
        }
        .fox { font-size: 6em; margin-bottom: 10px; }
        .fox-small { font-size: 2em; }
        button {
            background: #228B22;
            color: #fff;
            border: none;
            border-radius: 7px;
            padding: 15px 24px;
            margin: 7px 7px 7px 7px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #006c70;
        }
        input[type="text"] {
            font-size: 1.2em;
            padding: 7px;
            border-radius: 7px;
            border: 2px solid #228B22;
            text-align: center;
            width: 80%;
        }
        .hidden { display: none; }
        .streak-info { font-size: 1.1em; margin-bottom: 10px; }
        .number-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 28px 0;
        }
        .grid-item {
            background: #f4fff4;
            border: 2px solid #228B22;
            border-radius: 8px;
            font-size: 2.05em;
            height: 65px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s, border 0.2s;
            user-select: none;
        }
        .grid-item.missing {
            background: #fffbe4;
            border: 2px dashed #d4bc00;
            cursor: pointer;
        }
        .grid-item.correct {
            background: #c3f6c1;
            border: 2px solid #14b83a;
        }
        .grid-item.incorrect {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }
        .progress-table {
            width: 100%;
            border-collapse: collapse;
            margin: 18px 0 10px 0;
        }
        .progress-table th, .progress-table td {
            border: 1px solid #bbb;
            padding: 7px 2px;
            text-align: center;
        }
        .progress-table th {
            background: #e9f7ef;
            color: #228B22;
            font-size: 1.06em;
        }
        .progress-table tr.total-row {
            font-weight: bold;
            background: #f2f2f2;
        }
        .positive-comment {
            color: #228B22;
            font-weight: bold;
            margin-bottom: 14px;
            font-size: 1.14em;
        }
        .directions {
            color: #444;
            margin-bottom: 10px;
            font-size: 1.05em;
        }
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 7px;
        }
        .longest-streak {
            font-size: 0.95em;
            color: #009b2e;
            margin-top: 3px;
        }
        @media (max-width: 600px) {
            h1 { font-size: 2.5em; }
            .fox { font-size: 7em; }
            button { font-size: 1.4em; padding: 20px 30px; }
            .intro { font-size: 2em; }
            .game-header { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
<!-- Welcome Screen -->
<div id="welcome">
    <div class="container">
        <h1>üéØ Detective Number Mystery</h1>
        <div class="fox">ü¶äüîç</div>
        <div class="intro">Hi! I'm Memo the Fox!</div>
        <button type="button" onclick="startIntro()">üîä Meet Memo!</button>
    </div>
</div>

<!-- Name Entry -->
<div id="name-screen" class="hidden">
    <div class="container">
        <h1>üéØ Detective Number Mystery</h1>
        <div class="fox">ü¶äüîç</div>
        <div class="section">
            <div class="directions">What's your name, detective?</div>
            <input type="text" id="nameField" placeholder="Enter your name" maxlength="15">
            <br>
            <button class="continue-btn" type="button" onclick="processName()">Next</button>
        </div>
    </div>
</div>

<!-- Game Screen -->
<div id="game-screen" class="hidden">
    <div class="container">
        <div class="game-header">
            <h1 id="level-header" style="margin: 0; font-size: 1.8em; color: #228B22;">üéØ Level: Numbers 1-4</h1>
            <div>
                <div class="fox-small">ü¶äüîç</div>
                <div class="longest-streak">LONGEST: <span id="longest-streak">0</span></div>
            </div>
        </div>
        <div class="streak-info" id="streak-display">
            STREAK: 0 | MISSION: Get 5 in a row!
        </div>
        <div class="directions" id="level-direction">
            Numbers 1 through 4 below, some are missing:
        </div>
        <div class="timer-display hidden" id="timer-display"></div>
        <div class="number-grid" id="number-grid"></div>
        <div id="five-row-options" class="hidden">
            <button onclick="repeatLevel()">Same Level</button>
            <button onclick="nextLevel()">Next Level</button>
            <button onclick="showProgress()">See Your Progress</button>
            <button onclick="endGame()">End</button>
        </div>
    </div>
</div>

<!-- Progress Screen -->
<div id="progress-screen" class="hidden">
    <div class="container">
        <div style="font-size: 1.3em; font-weight: bold; margin-bottom: 7px;" id="progress-child-name"></div>
        <table class="progress-table" id="progress-table">
            <!-- Table gets generated dynamically -->
        </table>
        <div class="positive-comment" id="positive-comment"></div>
        <button onclick="returnToGame()">Return to Game</button>
        <button onclick="endGame()">Quit</button>
    </div>
</div>

<!-- End Screen -->
<div id="end-screen" class="hidden">
    <div class="container">
        <h1>Great job, <span id="end-child-name"></span>!</h1>
        <div class="fox">ü¶ä</div>
        <div class="positive-comment" id="end-positive-comment"></div>
        <button onclick="location.reload()">Play Again</button>
    </div>
</div>

<script>
    // --- Game State ---
    let childName = "";
    let currentLevel = 4;
    let levels = [4, 5, 6, 7, 8];
    let categories = ["1-4", "1-5", "1-6", "1-7", "1-8"];
    let progress = { "1-4": {correct:0, total:0}, "1-5": {correct:0, total:0}, "1-6": {correct:0, total:0}, "1-7": {correct:0, total:0}, "1-8": {correct:0, total:0} };
    let streak = 0;
    let longestStreak = 0;
    let fiveRowAchieved = false;

    // --- UI Navigation ---
    function show(id) {
        document.getElementById("welcome").classList.add("hidden");
        document.getElementById("name-screen").classList.add("hidden");
        document.getElementById("game-screen").classList.add("hidden");
        document.getElementById("progress-screen").classList.add("hidden");
        document.getElementById("end-screen").classList.add("hidden");
        document.getElementById(id).classList.remove("hidden");
    }

    function startIntro() {
        show('name-screen');
        setTimeout(()=>{document.getElementById('nameField').focus()}, 400);
    }

    function processName() {
        let name = document.getElementById("nameField").value.trim();
        if(name.length == 0) {
            alert("Please enter your name!");
            return;
        }
        childName = name;
        show('game-screen');
        updateGameHeader();
        setupLevel();
    }

    function updateGameHeader() {
        document.getElementById("level-header").textContent = `üéØ Level: Numbers 1-${currentLevel}`;
        document.getElementById("longest-streak").textContent = longestStreak;
        document.getElementById("level-direction").textContent = `Numbers 1 through ${currentLevel} below, some are missing:`;
    }

    // --- Game Logic ---
    function setupLevel() {
        streak = 0;
        fiveRowAchieved = false;
        document.getElementById("streak-display").textContent = "STREAK: 0 | MISSION: Get 5 in a row!";
        document.getElementById("five-row-options").classList.add("hidden");
        createGrid();
    }

    function createGrid() {
        const gridDom = document.getElementById("number-grid");
        gridDom.innerHTML = "";
        let nums = [];
        for(let i=1;i<=currentLevel;i++) nums.push(i);
        // pick 1-2 numbers to hide
        let missing = [];
        let ct = currentLevel===4?1:2;
        while(missing.length<ct) {
            let n = nums[Math.floor(Math.random()*nums.length)];
            if(!missing.includes(n)) missing.push(n);
        }
        let display = nums.map(n=>missing.includes(n)?null:n);
        // shuffle display
        for(let i=display.length-1;i>0;i--) {
            let j = Math.floor(Math.random()*(i+1));
            [display[i],display[j]] = [display[j],display[i]];
        }
        // Render grid
        display.forEach((n,idx)=>{
            let div = document.createElement("div");
            div.className = "grid-item";
            if(n===null) {
                div.classList.add("missing");
                div.textContent = "?";
                div.onclick = ()=>promptForMissing(nums, missing, idx, div, display);
            } else {
                div.textContent = n;
            }
            gridDom.appendChild(div);
        });
    }

    function promptForMissing(nums, missing, idx, div, display) {
        if(div.classList.contains("correct") || div.classList.contains("incorrect")) return;
        let guess = prompt(`What number is missing here? (1-${currentLevel})`);
        if(guess && !isNaN(guess)) {
            guess = parseInt(guess);
            if(missing.includes(guess)) {
                div.textContent = guess;
                div.classList.add("correct");
                div.classList.remove("missing");
                streak++;
                if(streak > longestStreak) longestStreak = streak;
                document.getElementById("streak-display").textContent = `STREAK: ${streak} | MISSION: Get 5 in a row!`;
                let cat = `1-${currentLevel}`;
                progress[cat].correct += 1;
                progress[cat].total += 1;
                // Check for five-in-a-row
                if(streak === 5 && !fiveRowAchieved) {
                    fiveRowAchieved = true;
                    document.getElementById("five-row-options").classList.remove("hidden");
                } else {
                    setTimeout(createGrid, 600);
                }
            } else {
                div.classList.add("incorrect");
                streak = 0;
                document.getElementById("streak-display").textContent = `STREAK: 0 | MISSION: Get 5 in a row!`;
                let cat = `1-${currentLevel}`;
                progress[cat].total += 1;
                setTimeout(createGrid, 800);
            }
        }
    }

    function repeatLevel() {
        setupLevel();
    }

    function nextLevel() {
        let idx = levels.indexOf(currentLevel);
        if(idx<levels.length-1) {
            currentLevel = levels[idx+1];
            updateGameHeader();
            setupLevel();
        }
        else {
            showProgress();
        }
    }

    function showProgress() {
        show("progress-screen");
        document.getElementById("progress-child-name").textContent = childName + "'s Progress";
        renderProgressTable();
        document.getElementById("positive-comment").textContent = positiveComment();
    }

    function positiveComment() {
        let totalCorrect = 0, totalTotal = 0;
        for(let cat of categories) {
            totalCorrect += progress[cat].correct;
            totalTotal += progress[cat].total;
        }
        if(totalCorrect===0) return "Let's get started!";
        if(totalCorrect/totalTotal > 0.9) return "Fantastic work! Keep it up!";
        if(totalCorrect/totalTotal > 0.75) return "Great job, you're getting really good!";
        if(totalCorrect/totalTotal > 0.5) return "Good effort! Practice makes perfect!";
        return "Every try helps you learn!";
    }

    function renderProgressTable() {
        let table = document.getElementById("progress-table");
        let html = `<tr>
            <th>Level</th>
            <th>Correct</th>
            <th>Out Of</th>
        </tr>`;
        let totalCorrect = 0, totalTotal = 0;
        for(let cat of categories) {
            html += `<tr>
                <td>${cat}</td>
                <td>${progress[cat].correct}</td>
                <td>${progress[cat].total}</td>
            </tr>`;
            totalCorrect += progress[cat].correct;
            totalTotal += progress[cat].total;
        }
        html += `<tr class="total-row">
            <td>Total</td>
            <td>${totalCorrect}</td>
            <td>${totalTotal}</td>
        </tr>`;
        table.innerHTML = html;
    }

    function returnToGame() {
        show("game-screen");
        updateGameHeader();
        setupLevel();
    }

    function endGame() {
        show("end-screen");
        document.getElementById("end-child-name").textContent = childName;
        document.getElementById("end-positive-comment").textContent = positiveComment();
    }

    // --- Start at Welcome ---
    show('welcome');
</script>
</body>
</html>
